<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <meta name="theme-color" content="#4a9d6f">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="format-detection" content="telephone=no">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="/icon-192.svg">
  <meta name="description" content="Chinese Flashcards - Interactive Vocabulary Practice">
  <title>Flashcards - Chinese Language Tutor</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <nav class="navbar">
    <div class="container">
      <div class="nav-wrapper">
        <div class="logo">LangTutor</div>
        <button class="mobile-menu-toggle" onclick="toggleMobileMenu()" aria-label="Toggle menu">
          ‚ò∞
        </button>
        <ul class="nav-links" id="mobileMenu">
          <li><a href="index.html#home" class="nav-link" onclick="closeMobileMenu()">Home</a></li>
          <li><a href="quiz-select.html" class="nav-link">Quizzes</a></li>
          <li><a href="test-select.html" class="nav-link">Tests</a></li>
          <li><a href="flashcard-select.html" class="nav-link">Flashcards</a></li>
          <!-- Progress link removed -->
          <li><a href="resources.html" class="nav-link">Resources</a></li>
        </ul>
        <button id="darkModeToggle" class="dark-mode-toggle" onclick="DarkMode.toggle()" aria-label="Toggle dark mode">üåô</button>
        <!-- Install button removed -->
      </div>
    </div>
  </nav>

  <section class="practice" style="padding: 60px 0; min-height: 80vh;">
    <div class="container">
      <h2>Chinese Flashcards</h2>
      <p class="section-subtitle" id="subtitle">Click card to flip ‚Ä¢ Swipe or use arrows to navigate</p>

      <!-- Progress Indicator -->
      <div style="text-align: center; margin-bottom: 20px;">
        <span id="cardProgress" style="font-size: 1.2rem; color: var(--accent); font-weight: 600;">1 / 10</span>
      </div>

      <!-- Flashcard -->
      <div class="flashcard-container">
        <div class="flashcard" id="flashcard" onclick="flipCard()">
          <div class="flashcard-face flashcard-front">
            <div class="flashcard-text" id="frontText">‰Ω†Â•Ω</div>
          </div>
          <div class="flashcard-face flashcard-back">
            <div class="flashcard-pinyin" id="backPinyin">n«ê h«éo</div>
            <div class="flashcard-meaning" id="backMeaning">Hello</div>
          </div>
        </div>
      </div>

      <!-- Navigation -->
      <div style="text-align: center; margin-top: 30px; display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
        <button class="btn btn-secondary" onclick="previousCard()">‚Üê Previous</button>
        <button class="btn btn-primary" onclick="nextCard()">Next ‚Üí</button>
        <button class="btn btn-secondary" onclick="shuffleCards()">üîÄ Shuffle</button>
      </div>

      <div style="text-align: center; margin-top: 20px;">
        <p style="color: var(--text-secondary); font-size: 0.9rem;">
          Keyboard shortcuts: Space to flip, Arrow keys to navigate
        </p>
        <a href="flashcard-select.html" class="btn btn-secondary" style="display: inline-block; margin-top: 15px;">Back to Selection</a>
      </div>
    </div>
  </section>

  <footer class="footer">
    <div class="container">
      <p>&copy; 2026 Chinese Language Tutor. All rights reserved.</p>
    </div>
  </footer>

  <script src="app.js"></script>
  <script src="quizzes.js"></script>
  <script>
    let currentDeck = [];
    let currentCardIndex = 0;
    let isFlipped = false;
    let currentLanguage = '';
    let currentLevel = '';
    let currentCategory = '';
    let currentSublevel = '';

    // Load flashcards based on URL parameters
    document.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(window.location.search);
      currentLanguage = params.get('language') || 'mandarin';
      currentLevel = params.get('level') || 'newbie';
      currentCategory = params.get('category') || '';
      currentSublevel = params.get('sublevel') || '';
      
      // Update subtitle with level info
      const levelNames = {
        'newbie': 'Newbie',
        'level1': 'Level 1',
        'level2': 'Level 2',
        'level3': 'Level 3',
        'sjkc': 'SJKC'
      };
      const categoryNames = {
        'text': 'Text',
        'hanyupinyin': 'Hanyu Pinyin',
        'extravocab': 'Extra Vocab'
      };
      
      const levelName = levelNames[currentLevel] || currentLevel;
      let subtitleText = levelName;
      
      if (currentCategory) {
        const categoryName = categoryNames[currentCategory] || currentCategory;
        subtitleText += ` - ${categoryName}`;
      }
      
      subtitleText += ' ‚Ä¢ Click card to flip ‚Ä¢ Swipe or use arrows to navigate';
      document.getElementById('subtitle').textContent = subtitleText;
      
      loadFlashcards();
    });

    function loadFlashcards() {
      // Helper to flatten nested arrays/objects into a single array of cards
      function flatten(group) {
        if (!group) return [];
        if (Array.isArray(group)) return group;
        if (typeof group === 'object') {
          return Object.values(group).reduce((acc, v) => acc.concat(flatten(v)), []);
        }
        return [];
      }

      // Check if level has categories (level1, level2)
      const levelData = FlashcardData[currentLanguage]?.[currentLevel];

      if (typeof levelData === 'object' && !Array.isArray(levelData)) {
        // Level has categories or nested sublevels
        if (currentCategory && levelData[currentCategory]) {
          // If a specific sublevel is selected, use it
          if (currentSublevel && levelData[currentCategory][currentSublevel]) {
            currentDeck = flatten(levelData[currentCategory][currentSublevel]);
            console.debug('Using specific sublevel:', currentSublevel);
          } else {
            currentDeck = flatten(levelData[currentCategory]);
          }
        } else if (currentSublevel && levelData[currentSublevel]) {
          // Level top-level sublevel (no category) requested
          currentDeck = flatten(levelData[currentSublevel]);
        } else {
          // No category/sublevel selected - combine all categories and sublevels
          currentDeck = flatten(levelData);
        }
      } else {
        // Level doesn't have categories (simple array)
        currentDeck = levelData || [];
      }

      // Debug: log deck size and what was selected
      console.debug('Flashcards loaded for', currentLevel, 'category', currentCategory, 'sublevel', currentSublevel, '->', currentDeck.length, 'cards');

      if (currentDeck.length === 0) {
        document.getElementById('flashcard').innerHTML = `
          <div style="padding: 40px; text-align: center;">
            <h3>No flashcards available</h3>
            <p>Flashcards for this level are coming soon!</p>
          </div>
        `;
        return;
      }

      currentCardIndex = 0;
      isFlipped = false;
      displayCard();
    }

    function displayCard() {
      if (currentDeck.length === 0) return;
      const card = currentDeck[currentCardIndex];
      const flashcard = document.getElementById('flashcard');
      // Reset flip state
      flashcard.classList.remove('flipped');
      isFlipped = false;

      // For 'newbie', Level 1, and Hanyu Pinyin/Extra Vocab categories, front = English/pinyin, back = meaning
      if (
        currentLevel === 'newbie' ||
        currentLevel === 'level1' ||
        currentCategory === 'hanyupinyin' ||
        currentCategory === 'extravocab'
      ) {
        document.getElementById('frontText').textContent = card.front || '';
        document.getElementById('backPinyin').textContent = '';
        document.getElementById('backMeaning').textContent = card.back || '';
      } else {
        // Default: front = Chinese (audio), back = pinyin + meaning
        document.getElementById('frontText').textContent = card.audio || card.front;
        document.getElementById('backPinyin').textContent = card.front || '';
        document.getElementById('backMeaning').textContent = card.back || '';
      }

      // Update progress
      document.getElementById('cardProgress').textContent = `${currentCardIndex + 1} / ${currentDeck.length}`;
    }

    function flipCard() {
      const flashcard = document.getElementById('flashcard');
      flashcard.classList.toggle('flipped');
      isFlipped = !isFlipped;
    }

    function nextCard() {
      if (currentDeck.length === 0) return;
      currentCardIndex = (currentCardIndex + 1) % currentDeck.length;
      displayCard();
    }

    function previousCard() {
      if (currentDeck.length === 0) return;
      currentCardIndex = (currentCardIndex - 1 + currentDeck.length) % currentDeck.length;
      displayCard();
    }

    function shuffleCards() {
      for (let i = currentDeck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [currentDeck[i], currentDeck[j]] = [currentDeck[j], currentDeck[i]];
      }
      currentCardIndex = 0;
      displayCard();
    }

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.key === ' ') {
        e.preventDefault();
        flipCard();
      } else if (e.key === 'ArrowRight') {
        nextCard();
      } else if (e.key === 'ArrowLeft') {
        previousCard();
      }
    });

    // Touch swipe support
    let touchStartX = 0;
    let touchEndX = 0;
    
    document.getElementById('flashcard').addEventListener('touchstart', (e) => {
      touchStartX = e.changedTouches[0].screenX;
    });
    
    document.getElementById('flashcard').addEventListener('touchend', (e) => {
      touchEndX = e.changedTouches[0].screenX;
      handleSwipe();
    });
    
    function handleSwipe() {
      if (touchEndX < touchStartX - 50) {
        nextCard();
      }
      if (touchEndX > touchStartX + 50) {
        previousCard();
      }
    }

    function toggleMobileMenu() {
      const menu = document.getElementById('mobileMenu');
      menu.classList.toggle('active');
    }

    function closeMobileMenu() {
      const menu = document.getElementById('mobileMenu');
      menu.classList.remove('active');
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      loadFlashcards();
    });
  </script>

</body>
</html>
